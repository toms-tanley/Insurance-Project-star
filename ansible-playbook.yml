- name: Docker configure in EC2 Instances
  hosts: all
  become: true
  connection: ssh
  tasks:
    - name: updating the New Ec2 Machine
      command: sudo apt-get update

    - name: Install Docker
      command: sudo apt-get install docker.io -y
      become: yes
      #become_user: root

    - name: Start Docker Service
      command: sudo systemctl start docker
      become: yes
      #become_user: root

    - name: Cleaning the docker
      command: docker rm -f $(docker ps -a -q) && docker rmi -f $(docker images -aq)

    - name: Pull the Image
      command: docker pull thomasdevops003/insureme_project123:latest

    - name: Deploy the Image and Run as Container
      command: docker run -d -p 8081:8081 thomasdevops003/insureme_project123:latest
